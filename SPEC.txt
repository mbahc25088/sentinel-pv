VERSION DOOM — SINGLE SOURCE OF TRUTH
====================================

This file is authoritative.
Code is judged against this file, not memory.

--------------------------------------------------
PHASE 0 — CONTRACT & INVARIANTS (LOCKED)
--------------------------------------------------

Backend structure (LOCKED):

sentinel-pv/
├── docker-compose.yml
├── SPEC.txt
└── backend/
    ├── Dockerfile
    ├── requirements.txt
    └── app/
        ├── __init__.py
        ├── main.py
        └── lifecycle.py

Rules:
- lifecycle.py name is IMMUTABLE
- Postgres will be sole system of record (later phase)
- No automated regulatory decisions
- Human-in-the-loop mandatory

--------------------------------------------------
PHASE 1 — RUNTIME & LIFECYCLE
--------------------------------------------------

SUBSECTION 1.1 — Runtime Bootstrap (LOCKED)
- FastAPI base
- Uvicorn entry
- Health endpoint
- lifecycle.py introduced

SUBSECTION 1.2 — Lifecycle State Gate (LOCKED)
- Deterministic lifecycle states
- Explicit state transitions
- No side effects

SUBSECTION 1.3 — Configuration Spine (ACTIVE)
---------------------------------------------

Files:
- backend/app/config.py (NEW)
- backend/app/main.py (UPDATED)

Responsibilities:

config.py:
- Single source of truth for environment configuration
- Immutable dataclass (frozen)
- No I/O
- No runtime mutation
- Imported by main.py only

main.py:
- Reads configuration from CONFIG
- Exposes /config diagnostic endpoint
- Exposes /health with lifecycle + config metadata
- MUST NOT mutate CONFIG

Invariants:
- Configuration is read-only after process start
- No environment-dependent logic outside config.py
- No file other than config.py may read os.environ directly

LOCK RULE:
- Any future change to config requires FULL FILE REPLACEMENT
- Any rename or relocation requires explicit unlock

--------------------------------------------------
END OF SPEC
--------------------------------------------------
